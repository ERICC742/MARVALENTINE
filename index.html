<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pac-Man Neon Hearts</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  overflow: hidden;
  touch-action: none;
}

canvas {
  display: block;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* GRID */
const cols = 19;
const rows = 21;
let tile = Math.min(canvas.width / cols, canvas.height / rows);

const map = [
  "###################",
  "#........#........#",
  "#.####.###.#.###.###",
  "#.................#",
  "#.####.#.#####.#.##",
  "#......#...#.....#",
  "######.###.#.###.###",
  "#........#........#",
  "#.####.###.#.###.###",
  "#................#",
  "###################"
];

let pacman = { x: 1, y: 1, dx: 0, dy: 0 };

const ghosts = [
  { x: 9, y: 5, color: "#ff0000" }, // Blinky
  { x: 8, y: 5, color: "#ffb8ff" }, // Pinky
  { x: 10, y: 5, color: "#00ffff" }, // Inky
  { x: 9, y: 6, color: "#ffb852" }  // Clyde
];

let pellets = [];
map.forEach((r,y)=>r.split("").forEach((c,x)=>{
  if(c===".") pellets.push({x,y});
}));

/* TOUCH CONTROLS â€” SCREEN QUADRANTS */
canvas.addEventListener("touchstart", e => {
  const t = e.touches[0];
  const x = t.clientX;
  const y = t.clientY;

  const cx = canvas.width / 2;
  const cy = canvas.height / 2;

  if (Math.abs(x - cx) > Math.abs(y - cy)) {
    pacman.dx = x > cx ? 1 : -1;
    pacman.dy = 0;
  } else {
    pacman.dy = y > cy ? 1 : -1;
    pacman.dx = 0;
  }
});

/* DRAWING */
function drawMaze() {
  ctx.fillStyle = "#7b2cff";
  map.forEach((r,y)=>r.split("").forEach((c,x)=>{
    if(c==="#") ctx.fillRect(x*tile,y*tile,tile,tile);
  }));
}

function drawHeart(x,y,p) {
  ctx.save();
  ctx.translate(x,y);
  ctx.scale(0.5 + p, 0.5 + p);
  ctx.beginPath();
  ctx.moveTo(0,3);
  ctx.bezierCurveTo(-4,-2,-8,3,0,10);
  ctx.bezierCurveTo(8,3,4,-2,0,3);
  ctx.fillStyle = "#39ff14";
  ctx.shadowColor = "#39ff14";
  ctx.shadowBlur = 15;
  ctx.fill();
  ctx.restore();
}

function drawPacman() {
  ctx.beginPath();
  ctx.arc(
    pacman.x*tile+tile/2,
    pacman.y*tile+tile/2,
    tile/2.3,
    0.25*Math.PI,
    1.75*Math.PI
  );
  ctx.lineTo(pacman.x*tile+tile/2,pacman.y*tile+tile/2);
  ctx.fillStyle = "#ffd700";
  ctx.shadowBlur = 10;
  ctx.shadowColor = "#ffd700";
  ctx.fill();
}

function drawGhost(g) {
  const x = g.x*tile+tile/2;
  const y = g.y*tile+tile/2;

  ctx.beginPath();
  ctx.arc(x, y, tile/2.2, Math.PI, 0);
  ctx.lineTo(x+tile/2.2, y+tile/2.2);
  ctx.lineTo(x-tile/2.2, y+tile/2.2);
  ctx.closePath();
  ctx.fillStyle = g.color;
  ctx.shadowColor = g.color;
  ctx.shadowBlur = 12;
  ctx.fill();
}

/* MOVEMENT */
function canMove(x,y) {
  return map[y] && map[y][x] !== "#";
}

function movePacman() {
  const nx = pacman.x + pacman.dx;
  const ny = pacman.y + pacman.dy;
  if (canMove(nx,ny)) {
    pacman.x = nx;
    pacman.y = ny;
  }
}

function moveGhost(g) {
  const dx = pacman.x - g.x;
  const dy = pacman.y - g.y;

  let options = [];
  if (canMove(g.x+1,g.y)) options.push({dx:1,dy:0});
  if (canMove(g.x-1,g.y)) options.push({dx:-1,dy:0});
  if (canMove(g.x,g.y+1)) options.push({dx:0,dy:1});
  if (canMove(g.x,g.y-1)) options.push({dx:0,dy:-1});

  options.sort((a,b)=>
    Math.hypot(dx-a.dx,dy-a.dy)-Math.hypot(dx-b.dx,dy-b.dy)
  );

  if(options[0]) {
    g.x += options[0].dx;
    g.y += options[0].dy;
  }
}

/* GAME LOOP */
let pulse = 0;
function loop() {
  pulse += 0.02;
  tile = Math.min(canvas.width / cols, canvas.height / rows);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawMaze();

  pellets = pellets.filter(p=>{
    drawHeart(p.x*tile+tile/2,p.y*tile+tile/2,Math.sin(pulse)*0.1);
    return !(p.x===pacman.x && p.y===pacman.y);
  });

  movePacman();
  drawPacman();

  ghosts.forEach(g=>{
    moveGhost(g);
    drawGhost(g);
  });

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>

